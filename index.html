<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ขึ้นทะเบียนขอใช้รถ - ม.วลัยลักษณ์</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f7f7fb; font-family: 'Noto Sans Thai', sans-serif; }
    .header { background: linear-gradient(45deg, #d3b0ff, #ffcb9a); padding: 20px; color: white; text-align: center; border-radius: 10px; margin-bottom: 20px; }
    .form-section { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 30px; }
    label.required:after { content: " *"; color: red; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h3>ระบบขึ้นทะเบียนขอใช้รถ - มหาวิทยาลัยวลัยลักษณ์</h3>
    </div>
    <form id="registerForm" enctype="multipart/form-data">
      <div class="form-section">
        <h5>ส่วนที่ 1: ข้อมูลส่วนตัว</h5>
        <div class="mb-3"><label class="form-label required">รหัสนักศึกษา</label><input type="text" class="form-control" name="studentId" pattern="\d{8}" required></div>
        <div class="mb-3"><label class="form-label required">ชื่อ-สกุล</label><input type="text" class="form-control" name="fullname" required></div>
        <div class="mb-3"><label class="form-label required">สำนักวิชา</label>
          <select class="form-select" name="faculty" required>
            <option value="">-- เลือก --</option>
            <option>การจัดการ</option><option>การบัญชีและการเงิน</option><option>เทคโนโลยีการเกษตรและอุตสาหกรรมอาหาร</option><option>นิติศาสตร์</option>
            <option>พยาบาลศาสตร์</option><option>แพทยศาสตร์</option><option>เภสัชศาสตร์</option><option>รัฐศาสตร์และรัฐประศาสนศาสตร์</option>
            <option>วิทยาศาสตร์</option><option>วิศวกรรมศาสตร์และเทคโนโลยี</option><option>ศึกษาศาสตร์</option><option>ศิลปศาสตร์</option>
            <option>สถาปัตยกรรมศาสตร์และการออกแบบ</option><option>สหเวชศาสตร์</option><option>สาธารณสุขศาสตร์</option><option>สารสนเทศศาสตร์</option>
            <option>วิทยาลัยทันตแพทยศาสตร์นานาชาติ</option><option>วิทยาลัยนานาชาติ</option><option>วิทยาลัยสัตวแพทยศาสตร์อัครราชกุมารี</option>
          </select></div>
        <div class="mb-3"><label class="form-label required">เบอร์โทรศัพท์</label><input type="tel" class="form-control" name="phone" pattern="0\d{9}" required></div>
        <div class="mb-3"><label class="form-label required">ที่พักปัจจุบัน</label>
          <div class="form-check"><input class="form-check-input" type="radio" name="residence" value="หอพักภายในมหาวิทยาลัย" required> <label class="form-check-label">หอพักภายในมหาวิทยาลัย</label></div>
          <div class="form-check"><input class="form-check-input" type="radio" name="residence" value="หอพักภายนอกมหาวิทยาลัย"> <label class="form-check-label">หอพักภายนอกมหาวิทยาลัย</label></div>
          <div class="form-check"><input class="form-check-input" type="radio" name="residence" value="บ้านตนเอง"> <label class="form-check-label">บ้านตนเอง</label></div>
        </div>
        <div class="mb-3"><label class="form-label required">ชื่อหอพัก/หมายเลขห้อง/บ้านเลขที่</label><input type="text" class="form-control" name="roomAddress" required>
          <small class="form-text text-muted">กรณีหอพักให้กรอกชื่อหอพักและห้อง กรณีบ้านพักให้กรอกบ้านเลขที่และที่อยู่</small></div>
        <div class="mb-3"><label class="form-label required">ผู้ติดต่อกรณีฉุกเฉิน</label><input type="text" class="form-control" name="emergencyContact" required></div>
        <div class="mb-3"><label class="form-label required">ความสัมพันธ์กับนักศึกษา</label>
          <select class="form-select" name="emergencyRelation" required><option>บิดา/มารดา</option><option>ผู้ปกครอง</option><option>ญาติ</option><option>เพื่อน</option></select></div>
        <div class="mb-3"><label class="form-label required">เบอร์โทรศัพท์ผู้ติดต่อกรณีฉุกเฉิน</label><input type="tel" class="form-control" name="emergencyPhone" pattern="0\d{9}" required></div>
      </div>
      <div class="form-section">
        <h5>ส่วนที่ 2: ข้อมูลรถที่ขึ้นทะเบียน</h5>
        <div class="mb-3"><label class="form-label required">ประเภทรถ</label>
          <select class="form-select" name="vehicleType" required><option>รถยนต์(น้ำมัน)</option><option>รถยนต์ไฟฟ้า</option><option>รถจักรยานยนต์ไฟฟ้า</option></select></div>
        <div class="mb-3"><label class="form-label required">ยี่ห้อรถ</label><input type="text" class="form-control" name="vehicleBrand" required></div>
        <div class="mb-3"><label class="form-label required">เลขทะเบียนรถ</label><input type="text" class="form-control" name="licensePlate" required>
          <small class="form-text text-muted">กรณีป้ายแดง ให้พิมพ์ว่า "ป้ายแดง" หากไม่สามารถจดทะเบียนได้ ให้พิมพ์ว่า "ไม่สามารถจดทะเบียนได้"</small></div>
        <div class="mb-3"><label class="form-label required">จังหวัด</label>
          <select class="form-select" name="licenseProvince" required><option>ป้ายแดง</option><option>ไม่สามารถจดทะเบียนได้</option></select></div>
        <div class="mb-3"><label class="form-label">สีรถ</label><input type="text" class="form-control" name="vehicleColor"></div>
        <div class="mb-3"><label class="form-label required">ภาพรถด้านหน้า</label><input type="file" class="form-control" name="imageFront" accept="image/*" required></div>
        <div class="mb-3"><label class="form-label required">ภาพรถด้านหลัง</label><input type="file" class="form-control" name="imageBack" accept="image/*" required></div>
        <div class="mb-3"><label class="form-label required">ภาพรถด้านซ้าย</label><input type="file" class="form-control" name="imageLeft" accept="image/*" required></div>
        <div class="mb-3"><label class="form-label required">ภาพรถด้านขวา</label><input type="file" class="form-control" name="imageRight" accept="image/*" required></div>
        <div class="mb-3 form-check">
          <input class="form-check-input" type="checkbox" id="confirmCheck" required>
          <label class="form-check-label required" for="confirmCheck">ขอรับรองว่าข้อมูลถูกต้องและเป็นความจริงทุกประการ...</label>
        </div>
        <button type="button" class="btn btn-primary" onclick="submitForm()">ส่งข้อมูล</button>
      </div>
    </form>
  </div>
  <script>
    async function submitForm() {
      const form = document.getElementById("registerForm");
      const formData = new FormData(form);
      const imageFields = ["imageFront", "imageBack", "imageLeft", "imageRight"];
      const uploadImage = async (file) => {
        const imgData = new FormData();
        imgData.append("file", file);
        const response = await fetch("https://script.google.com/macros/s/AKfycbzFR04epoLxFzBecc-UIduoXIcTfjq0XY8LAnkgSptz8w4CjK-1ge31JLlR5MWSuZJS/exec", {
          method: "POST", body: imgData });
        return await response.text();
      };
      const imageURLs = [];
      for (let field of imageFields) {
        const fileInput = document.querySelector(`input[name='${field}']`);
        if (fileInput.files.length > 0) {
          const url = await uploadImage(fileInput.files[0]);
          imageURLs.push(url);
        } else {
          alert(`กรุณาแนบรูปภาพให้ครบ: ${field}`);
          return;
        }
      }
      formData.append("imageFrontURL", imageURLs[0]);
      formData.append("imageBackURL", imageURLs[1]);
      formData.append("imageLeftURL", imageURLs[2]);
      formData.append("imageRightURL", imageURLs[3]);
      const response = await fetch("https://script.google.com/macros/s/AKfycbz8wSBOi4--ZlvfKGxZUB_mjCDEJefBx41maq1aD2P1OUt8P0i_PAroLfLcYA9AYtg9ew/exec", {
        method: "POST", body: formData });
      const result = await response.text();
      alert(result);
      form.reset();
    }
  </script>
</body>
</html>
